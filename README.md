# sokoban-vue3

## [åˆå§‹åŒ–é¡¹ç›®](https://github.com/HenryTSZ/sokoban-vue3/tree/68b262e0a4772b868b4f4352bf41939f96a6b7ad)

## [åˆ›å»ºåœ°å›¾](https://github.com/HenryTSZ/sokoban-vue3/tree/34ea99dbe041f1789aacd3aac3c7ad1f0b987fbd)

## [é‡æ„åŠå•æµ‹åœ°å›¾](https://github.com/HenryTSZ/sokoban-vue3/tree/14888773c1b9d4c2c9a1f890cf836229dc0a66f7)

## [æ·»åŠ ç©å®¶](https://github.com/HenryTSZ/sokoban-vue3/tree/8b487da65560ececa311a5b7be7c3400e99608cf)

## [ç©å®¶ç§»åŠ¨ä½ç½®](https://github.com/HenryTSZ/sokoban-vue3/tree/9acd676ee8399f2f41e666363a4ddf273c1930c4)

## [ç¢°æ’æ£€æµ‹](https://github.com/HenryTSZ/sokoban-vue3/tree/76f2289456bfde01ede6f4b0948f8a3a5f78b5a6)

## [é‡æ„ç©å®¶æ•°æ®ç»“æ„](https://github.com/HenryTSZ/sokoban-vue3/tree/63fb1f9bd9915a4450b0b6c89deee6e11be7dd06)

## [å®Œæˆç©å®¶ç§»åŠ¨ä½ç½®](https://github.com/HenryTSZ/sokoban-vue3/tree/3510c6b4f6509e21b5a36742b1527f74f1be9be9)

## [æ·»åŠ ç®±å­](https://github.com/HenryTSZ/sokoban-vue3/tree/5275e5a04d37221b8e324e74aed5f539735c0f4b)

## [ç©å®¶æ¨ç€ç®±å­ç§»åŠ¨](https://github.com/HenryTSZ/sokoban-vue3/tree/0d342cc8055e080d1380ca282a8974c3b8157b2a)

## [ç®±å­çš„ç¢°æ’æ£€æµ‹](https://github.com/HenryTSZ/sokoban-vue3/tree/647a0520c5c760d5ae97a63292927d7fac684306)

## [å®Œæˆç®±å­ç§»åŠ¨ä½ç½®](https://github.com/HenryTSZ/sokoban-vue3/tree/d4357f05de68758614ea555ad7a6a496b37c2abd)

## [è§£å†³ Map.vue é—ç•™æŠ¥é”™é—®é¢˜](https://github.com/HenryTSZ/sokoban-vue3/tree/4ac226cc42426d69b8b5ded3e3bb38ce9ad9f0aa)

## [é‡æ„ç§»åŠ¨é€»è¾‘](https://github.com/HenryTSZ/sokoban-vue3/tree/99b7c77ab47744ee8d1a4d6d5cbc230205fa0804)

## [ç®±å­ä¸ç®±å­çš„ç¢°æ’æ£€æµ‹](https://github.com/HenryTSZ/sokoban-vue3/tree/7531444c086a345cce0855ef7956598b19fd8ef7)

## [æ·»åŠ æ”¾ç½®ç‚¹](https://github.com/HenryTSZ/sokoban-vue3/tree/252048acc321dd3c0fadf645ca558d0f612f26d7)

## [ç®±å­ä¸æ”¾ç½®ç‚¹çš„ç¢°æ’æ£€æµ‹](https://github.com/HenryTSZ/sokoban-vue3/tree/70da190fc5ef796eab8ed2b2f9c103f1c7e321f5)

## [æ£€æµ‹æ¸¸æˆæ˜¯å¦èƒœåˆ©](https://github.com/HenryTSZ/sokoban-vue3/tree/c99ae23cefbc9ebf360e413b09fb4741f368e2cf)

## è¿›å…¥ä¸‹ä¸€å…³

æ¸¸æˆèƒœåˆ©ä»¥åè¦æ€ä¹ˆåŠå‘¢ï¼Ÿåº”è¯¥æ˜¯è¿›å…¥ä¸‹ä¸€å…³

åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¤„ç†å‡ ä»¶äº‹ï¼š

1. é‡ç½®æ‰€æœ‰æ•°æ®
2. è·å–åˆ°ä¸‹ä¸€å…³æ•°æ®å¹¶åˆå§‹åŒ–
3. è·³è½¬åˆ°ä¸‹ä¸€å…³

è¿™é‡Œçš„å…³å¡æ•°æ®å°±åŒ…æ‹¬ åœ°å›¾æ•°æ®/ç®±å­æ•°æ®/ç©å®¶æ•°æ®

ç”±äºç°åœ¨è¿™äº›æ•°æ®éƒ½åœ¨å„è‡ªç»„ä»¶ä¸­, æ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠå®ƒä»¬æŠ½ç¦»å‡ºæ¥ï¼Œæˆ‘ä»¬éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªæ‰€æœ‰å…³å¡çš„æ•°æ®

### åˆ›å»ºå…³å¡æ•°æ®

åœ¨ `src/game/gameData.ts` ä¸­åˆ›å»ºå…³å¡æ•°æ®ï¼Œç¬¬ä¸€å…³çš„æ•°æ®å°±ä½¿ç”¨æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„ï¼Œä¸ºäº†èƒ½å¿«é€Ÿé€šå…³ï¼Œæˆ‘ä»¬å°±è®¾ç½®ä¸€ä¸ªæ”¾ç½®ç‚¹å§ï¼Œç¬¬äºŒå…³æˆ‘ä»¬å°±å…ˆæ”¹å˜ä¸€ä¸‹åœ°å›¾æ•°æ®ï¼Œåˆ«çš„å…ˆä¸åŠ¨ï¼Œèƒ½æ¸²æŸ“å°±å¯ä»¥

å…·ä½“çš„ä»£ç è§ `src/game/gameData.ts`

å¦‚ä½•æ‹¿åˆ°å…³å¡æ•°æ®å‘¢ï¼Ÿ

å¯ä»¥é€šè¿‡ `gameDatas[getGame().level]` æ‹¿åˆ°å¯¹åº”å…³å¡çš„æ•°æ®, ç„¶ååˆå§‹åŒ–åœ°å›¾ç­‰æ•°æ®

### åˆå§‹åŒ–åœ°å›¾ç­‰æ•°æ®

```ts
const map = initMap(gameDatas[getGame().level].map)
```

ç”±äºæˆ‘ä»¬åˆå§‹åŒ–çš„ `level` æ˜¯ 1ï¼Œæ‰€ä»¥è¿™é‡Œçš„æ•°æ®åº”è¯¥æ˜¯ç¬¬äºŒå…³çš„æ•°æ®ï¼Œè€Œæˆ‘ä»¬éœ€è¦çš„æ˜¯ç¬¬ä¸€å…³çš„æ•°æ®ï¼Œæ‰€ä»¥åˆå§‹åŒ–è¿˜æ˜¯æ”¹æˆ 0 å§ï¼Œæ–¹ä¾¿å–å€¼

```ts
const game = reactive({
  isWin: false,
  level: 0
})
```

æ•°æ®æ‹¿åˆ°äº†ï¼Œé¡µé¢ä¹Ÿèƒ½æ­£å¸¸æ¸²æŸ“äº†

åŒç†å°†ç©å®¶å’Œç®±å­æ•°æ®åˆå§‹åŒ–

```ts
const keeper: Keeper = reactive(gameDatas[getGame().level].keeper)

const cargos: Cargo[] = reactive(gameDatas[getGame().level].cargos)
```

é¡µé¢æ˜¾ç¤ºæ²¡é—®é¢˜ï¼ŒåŠŸèƒ½ä¹Ÿæ­£å¸¸

![](public/023.png)

### è¿›å…¥ä¸‹ä¸€å…³é€»è¾‘

ç›®å‰æˆ‘ä»¬é€šå…³ä»¥åï¼Œåªæ˜¯æ˜¾ç¤ºäº†æ–‡å­—æç¤ºï¼Œåº”è¯¥å†åŠ ä¸€ä¸ªæŒ‰é’®ï¼Œè¿›å…¥ä¸‹ä¸€å…³

```vue
<div v-if="game.isWin">
  æ­å–œä½ ,ä½ å·²ç»é€šå…³äº†!
  <button @click="handleNextLevel">ä¸‹ä¸€å…³</button>
</div>

const handleNextLevel = () => { game.level++ }
```

é¡µé¢æ˜¾ç¤ºæ²¡é—®é¢˜ï¼Œä½†ç‚¹å‡»åå´æ²¡æ”¹å˜

è¿™æ˜¯è‚¯å®šçš„å•Šï¼Œæˆ‘ä»¬çš„ `initMap` ç­‰å‡½æ•°åªæ‰§è¡Œäº†ä¸€éï¼Œ`level` æ”¹å˜åå¹¶æ²¡æœ‰å†æ‰§è¡Œ

æ‰€ä»¥æˆ‘ä»¬éœ€è¦ç›‘å¬ `getGame().level` çš„å˜åŒ–ï¼Œå½“å˜åŒ–çš„æ—¶å€™æ‰§è¡Œ `initMap` ç­‰å‡½æ•°

```ts
let map: Element[][]

watchEffect(() => {
  map = initMap(gameDatas[getGame().level].map)
  console.log('ğŸš€ ~ file: Map.vue:30 ~ watchEffect ~ map:', map)
})
```

ä½†ç‚¹å‡»åä»ç„¶æ²¡æœ‰æ”¹å˜

é€šè¿‡æ‰“å°è¾“å‡ºå¯çŸ¥æ•°æ®å·²ç»å˜åŒ–äº†ï¼š

![](public/024.png)

é‚£è¿™åˆæ˜¯å“åº”å¼çš„é—®é¢˜äº†ï¼Œéœ€è¦ä½¿ç”¨ `reactive` è¿›è¡ŒåŒ…è£…

```ts
let map: Element[][] = reactive([])

watchEffect(() => {
  initMap(gameDatas[getGame().level].map).forEach((row, index) => {
    map[index] = row
  })
  console.log('ğŸš€ ~ file: Map.vue:30 ~ watchEffect ~ map:', map)
})
```

è¿™æ ·ç‚¹å‡»ä¸‹ä¸€å…³ååœ°å›¾å°±å˜åŒ–äº†

![](public/025.png)

é‚£æˆ‘ä»¬å†å¤„ç†ä¸€ä¸‹ç©å®¶å’Œç®±å­çš„æ•°æ®

```ts
let keeper: Keeper = reactive({} as Keeper)
let positionStyle: ComputedRef<string>

watchEffect(() => {
  const keeperData = gameDatas[getGame().level].keeper
  keeper.x = keeperData.x
  keeper.y = keeperData.y
  initKeeper(keeper)

  positionStyle = usePosition(keeper)
})
```

```ts
let cargos: Cargo[] = reactive([])
let positionStyles: ComputedRef<string>[]

watchEffect(() => {
  gameDatas[getGame().level].cargos.forEach(cargo => {
    cargos.push(cargo)
  })
  initCargos(cargos)

  positionStyles = cargos.map(cargo => usePosition(cargo))
})
```

ç°åœ¨è¿›å…¥ä¸‹ä¸€å…³æ‰€æœ‰æ•°æ®éƒ½å˜äº†ï¼Œä½†ç®±å­ç”±äºæˆ‘ä»¬æ²¡æœ‰æ¸…é™¤ä¸Šä¸€å…³çš„æ•°æ®ï¼Œæ‰€ä»¥è¿˜æ˜¯ä¼šæ˜¾ç¤ºä¸Šä¸€å…³çš„ç®±å­ï¼Œè€Œä¸”é€šå…³çŠ¶æ€ä¹Ÿæ²¡æœ‰æ”¹å˜

![](public/026.png)

æ‰€ä»¥åœ¨ `push` å‰éœ€è¦æ¸…ç©ºæ•°ç»„ï¼Œ`map` ç”±äºæˆ‘ä»¬ç›´æ¥ä¿®æ”¹çš„ `index`ï¼Œæ‰€ä»¥å¯ä»¥æ­£å¸¸æ˜¾ç¤ºï¼Œä¸è¿‡ä¹Ÿè¿˜æ˜¯æ¸…é™¤ä¸€ä¸‹å§ï¼Œä¸‡ä¸€ä¸¤å…³åœ°å›¾å¤§å°ä¸ä¸€è‡´ï¼Œå°±æœ‰é—®é¢˜äº†

æ¸…é™¤å°±ä½¿ç”¨ `map.length = 0` å’Œ `cargos.length = 0` å°±å¯ä»¥äº†

é€šå…³çŠ¶æ€ä¹Ÿé‡ç½®ä¸€ä¸‹

```ts
const handleNextLevel = () => {
  game.level++
  game.isWin = false
}
```

è¿™æ ·å°±æ²¡æœ‰é—®é¢˜äº†

![](public/027.png)
